{% extends "base.html" %}
{% load staticfiles %}
{% load custom_filters %}

{% block content %}

<div id="records-title-bar">
    <div id="records-event-name">{{ event.name }}</div>

    <div id="records-control-buttons">
        <button class="button button-margin-right" onclick="window.location.href='{{ url_add_expense }}';">+ add expense</button>
        <button class="button button-no-margin" onclick="window.location.href='{{ url_add_transfer }}';">+ add transfer</button>
    </div>

    <div id="records-title-clearfix"></div>
</div>


{# TABLE VIEW FOR WIDE VIEWPORTS #}
<div id="records-table">

    <div class="records-col">
        <div class="records-cell records-header"></div>
        {% for record in money_records %}
            <div class="records-cell records-body expense-cell-id-{{ record.record_id }}">
                <a class="action-link" href="{{ record.url_edit }}">Edit</a>
            </div>
        {% endfor %}
        <div class="records-cell records-body-last-row"></div>
        <div class="records-cell records-footer"></div>
        <div class="records-cell records-footer"></div>
    </div>

    <div class="records-col">
        <div class="records-cell records-header">Date</div>
        {% for record in money_records %}
            <div class="records-cell records-body expense-cell-id-{{ record.record_id }}">{{ record.pub_date | date:"Y/m/d" }}</div>
        {% endfor %}
        <div class="records-cell records-body-last-row"></div>
        <div class="records-cell records-footer"></div>
        <div class="records-cell records-footer"></div>
    </div>

    <div class="records-col records-col-description">
        <div class="records-cell records-header">Description</div>
        {% for record in money_records %}
            <div class="records-cell records-body expense-cell-id-{{ record.record_id }}">{{ record.description }}</div>
        {% endfor %}
        <div class="records-cell records-body-last-row"></div>
        <div class="records-cell records-footer records-footer-strong">Total cost</div>
        <div class="records-cell records-footer records-footer-strong">Balance per person</div>
    </div>

    <div class="records-col records-col-amount">
        <div class="records-cell records-header">Amount</div>
        {% for record in money_records %}
            <div class="records-cell records-body expense-cell-id-{{ record.record_id }}">{{ record.total_amount | money_amount_hide_zero:'finance' }}</div>
        {% endfor %}
        <div class="records-cell records-body-last-row"></div>
        <div class="records-cell records-footer records-footer-strong">{{ event_total | money_amount:'finance' }}</div>
        <div class="records-cell records-footer records-footer-strong">{{ event_split | money_amount:'finance' }}</div>
    </div>

    <div id="participant-cols">
    {% for participant in participants %}
        <div class="records-col records-col-amount records-col-participant">
            <div class="records-cell records-header">{{ participant.get_name }}</div>
            {% for record in money_records %}
                <div class="records-cell records-body expense-cell-id-{{ record.record_id }}">{{ record.contributions | get_item:participant | money_amount_hide_zero:'finance' }}</div>
            {% endfor %}
            <div class="records-cell records-body-last-row"></div>
            <div class="records-cell records-footer">{{ participant_contribution | get_item:participant | money_amount:'finance' }}</div>
            <div class="records-cell records-footer">{{ participant_variance | get_item:participant | money_amount:'finance' }}</div>
        </div>
    {% endfor %}
    </div>

</div>


{# LIST VIEW FOR NARROW VIEWPORTS #}
<div id="records-list">
    <div id="record-list-items">
        {% for record in money_records %}
            <div class="record-list-item">
                <div class="record-list-item-line">
                    <div class="record-list-item-date">{{ record.pub_date | date:"Y/m/d" }}</div>
                    <div class="record-list-item-description">{{ record.description }}</div>
                </div>
                <div class="record-list-item-line">
                    <div class="record-list-item-participant">
                        {{ record.participant1.get_name }}
                        {% if record.participant2 %} â‡¨ {{ record.participant2.get_name }}{% endif %}
                    </div>
                    <div class="record-list-item-amount">{{ record.amount | money_amount:'simple' }}</div>
                    <div class="record-list-item-edit-link">
                        <a class="action-link" href="{{ record.url_edit }}">EDIT</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <div id="record-list-totals">

        <div class="record-list-totals-event">
            <div class="record-list-total-cost">Total event cost: {{ event_total | money_amount:'simple' }}</div>
            <div class="record-list-total-cost">Cost per person: {{ event_split | money_amount:'simple' }}</div>
        </div>

        {% for participant in participants %}
            <div class="record-list-totals-participant">
                <div class="record-list-totals-participant-name">{{ participant.get_name }}</div>
                <div class="record-list-totals-participant-cost">Contribution: {{ participant_contribution | get_item:participant | money_amount:'simple' }}</div>
                <div class="record-list-totals-participant-cost">
                    {% if participant in participant_overcontrib %}
                        Over-contribution: {{ participant_overcontrib | get_item:participant | money_amount:'simple' }}
                    {% elif participant in participant_undercontrib %}
                        Under-contribution: {{ participant_undercontrib | get_item:participant | money_amount:'simple' }}
                    {% else %}
                        Balance owed: $0.00
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>
</div>


{% endblock %}
